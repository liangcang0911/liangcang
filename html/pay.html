<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>良仓.生活美学平台</title>
		<link rel="icon" href="../images/favicon.ico"/>
		<link rel="stylesheet" href="../css/index.css" />
		<link rel="stylesheet" href="../css/top.css" />
		<link rel="stylesheet" type="text/css" href="../css/modal.css"/>
		<script src="../js/animate.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/myajax.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/index.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/modal.js" type="text/javascript" charset="utf-8"></script>
		<style>
	    form {
	      padding-right: 150px;
	    }
	    label {
	      display: block;
	      text-align: right;
	      margin-bottom: 5px;
	    }
			main>span{font-size: 16px;}
			#add-address{width: 100px;height: 30px;}
	    .address-ul {
	      overflow: hidden;
	      height: 140px;
	    }
	    .address-ul>li {
	      width: 228px;
	      height: 128px;margin-top: 10px;
	      overflow: hidden;
	      border: 1px solid #e4e4e4;
	      padding: 10px;
	      background-color: #fff;
	      line-height: 200%;
	      cursor: pointer;
	      box-sizing: border-box;
	    }
	    .address-ul li.selected {
	      border: 1px solid orange;
	    }
	    .delete {
	      float: right;
	      padding-left: 5px;
	      padding-right: 5px;
	      border: 1px solid orange;
	      border-radius: 5px;
	      background-color: orange;
	      color: white;
	      cursor: pointer;
	    }
	    .delete:hover {
	      background-color: white;
	      border-color: #000000;
	      color: black;
	    }
	    .show-all-address {
	      clear: both;
	      width: 80px;
	      height: 20px;
	      border-radius: 5px;
	      text-align: center;
	      line-height: 20px;
	      margin-top: 10px;
	      border: 1px solid orange;
	      padding: 5px;
	      cursor: pointer;
	      background-color: orange;
	      color: white;
	    }
	    .show-all-address:hover {
	      background-color: white;
	      color: orange;
	      border: 1px solid black;
	    }
	    #order{
	    	width: 200px;
	    	height: 30px;
	    	margin: auto;
	    	margin-top: 20px;
	    	text-align: center;
	    	line-height: 30px;
	    	background-color: #7fa6c5;
	    	color: #FFFFFF;
	    	border-radius: 5px;
	    	font-size: 16px;
	    	cursor: pointer;
	    }
	  </style>
	</head>
	<body>
		<div class="header">
			<div class="items-logo">
				<div>
					<a class="logo" href="index.html"></a>
					<ul>
						<li><a href="sign-in.html" class="first">登录</a>  &nbsp;<a href="sign-up.html" class="first">注册</a></li>
						<li class="line">|</li>
						<li id="shopping-cart">
							<a href="cart.html">购物车</a>
							<div class="cart">
								<div class="goods">
									你的购物车暂时没有商品...
								</div>
								<a href="#">快去请购良仓商品吧！</a>
							</div>
						</li>
						<li class="line">|</li>
						<li id="information1">
							<a href="information.html">消息</a>
							<ol>
								<li>
									<a href="movement.html">
										动态<span>0</span>
									</a>
								</li>
								<li>
									<a href="information.html">
										评论<span>0</span>
									</a>
								</li>
								<li>
									<a href="personal-letter.html">
										私信<span>0</span>
									</a>
								</li>
								<li>
									<a href="fans.html">
										粉丝<span>0</span>
									</a>
								</li>
								<li>
									<a href="like.html">
										喜欢<span>0</span>
									</a>
								</li>
								<li>
									<a href="inform.html">
										通知<span>0</span>
									</a>
								</li>
							</ol>
						</li>
						<li class="line">|</li>
						<li><a href="add.html">添加良品</a></li>
					</ul>
				</div>				
			</div>
			<div class="items-nav" id="items-nav">
				<div>
					<ul>
						<li class="first"><a href="#">首页</a></li>
						<li id="shop">
							<a href="#">商店</a>
							<div class="shop">
								<div>
									<div class="shop-list">
										<ul>
											<li>
												<a href="#">
													<img src="../images/23687.png"/>
													<span>家居</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23685.png"/>
													<span>家具</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23686.png"/>
													<span>文具</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23683.png"/>
													<span>数码</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23682.png"/>
													<span>娱乐</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23684.png"/>
													<span>厨卫</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23680.png"/>
													<span>美食</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23679.png"/>
													<span>男装</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23678.png"/>
													<span>女装</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>
											<li>
												<a href="#">
													<img src="../images/23677.png"/>
													<span>童装</span>											
												</a>
												<div class="shop-list-second">
													
												</div>
											</li>									
										</ul>
										<a href="#" class="pic">
											<img src="../images/315574.jpg"/>
											<span>新视线： 2015年7月刊</span>
										</a>
									</div>
									<div class="details">
										<a href="">查看所有品牌 &gt;</a>
										<a href="">最新到货 &gt;</a>
									</div>
								</div>
							</div>
						</li>
						<li id="magazin">
							<a href="#">杂志</a>
							<div class="magazin share">
								<ul>
									<li><a href="#">趣物</a></li>
									<li><a href="#">数码</a></li>
									<li><a href="#">汽车</a></li>
									<li><a href="#">文化</a></li>
									<li><a href="#">时尚</a></li>
									<li><a href="#">美食</a></li>
									<li><a href="#">建筑</a></li>
									<li><a href="#">空间</a></li>
									<li><a href="#">圈子</a></li>
									<li><a href="#">清单</a></li>
									<li><a href="#">活动</a></li>
									<li><a href="#">视频</a></li>
								</ul>
							</div>
						</li>
						<li id="share">
							<a href="#">分享</a>
							<div class="magazin share">
								<ul>
									<li><a href="#">男士</a></li>
									<li><a href="#">家居</a></li>
									<li><a href="#">数码</a></li>
									<li><a href="#">文具</a></li>
									<li><a href="#">玩具</a></li>
									<li><a href="#">美容</a></li>
									<li><a href="#">孩子</a></li>
									<li><a href="#">宠物</a></li>
									<li><a href="#">饮食</a></li>
									<li><a href="#">运动</a></li>
									<li><a href="#">文化</a></li>
									<li><a href="#">女士</a></li>
								</ul>
							</div>
						</li>
						<li><a href="#">达人</a></li>
					</ul>
					<div class="search">
						<div>
							<input id="search-ipt" type="text" placeholder="search..."/>
						</div>
						<a href="#" id="search-btn"></a>
					</div>			
				</div>
			</div>
		</div>
		<div id="shoptype">
			<div id="shopitem">
				<span id="span4">购物车</span>
				<span id="span3">付款</span>
			</div>
		</div>
	  <main>
    <span>收货地址:</span>
    <input type="button" id="add-address" value="添加收货地址" />
    <div class="address">
      <div>
        <ul class="address-ul">
        </ul>
      </div>
      <div class="show-all-address">显示全部地址</div>
      <script>
        var oShowAllAddress = document.querySelector('.show-all-address');
        oShowAllAddress.addEventListener('click', function(){
          var oAddressUl = document.querySelector('.address-ul');
          var overflow = fetchComputedStyle(oAddressUl, 'overflow');
          var flag = overflow === 'hidden' ? false : true;
          oAddressUl.style.overflow = !flag ? 'visible' : 'hidden';
          this.innerText = flag ? '显示全部地址' : '隐藏地址';
        });
      </script>
    </div>
    <script>
      //ajax读取到收货地址并显示
      function showAddress() {
        myajax.get('http://h6.duchengjiu.top/shop/api_useraddress.php',
        {token: localStorage.token},
        function(error, responseText) {
          var json = JSON.parse(responseText);
          console.log(json);
          var data = json.data;
          var oAddressUl = document.querySelector('.address-ul');
          if (data.length === 0) {
            oAddressUl.innerHTML = '<h2>您还没有收货地址，请点击添加收货地址</h2>';
            return;
          }
          oAddressUl.innerHTML = '';
          for (var i = data.length - 1; i >= 0; i--) {
            var obj = data[i];
            oAddressUl.innerHTML += `
                            <li data-id="${obj.address_id}">
                              <span>收货人：${obj.consignee}</span><span name="delete" class="delete" data-id="${obj.address_id}">删除</span><br />
                              <span>手机：${obj.mobile}</span><br />
                              <span>地址：${obj.address}</span>
                            </li>
            `;
          }
        })
      }
      showAddress();

      var selected_address_id = 0;//如果这个值为0，无法下订单，当点击一个收货地址时，给这个变量赋值
      //给收货地址添加一个事件代理
      var oAddressUl = document.querySelector('.address-ul');
      oAddressUl.onclick = function(event) {
        event = event || window.event;
        var target = event.target || event.srcElement;
        console.log(target.nodeName);
        if (target.className === 'delete') {
          if (!confirm('确认要删除收货地址吗？')) {
            return;
          }
          var address_id = target.dataset.id;
          console.log(address_id);
          myajax.get('http://h6.duchengjiu.top/shop/api_useraddress.php',
          {status: 'delete', address_id, token: localStorage.token}, function(error, responseText){
            var json = JSON.parse(responseText);
            if (json.code === 0) {
              target.parentNode.parentNode.removeChild(target.parentNode);
            }
          })
        } else {
          //先让所有li元素的样式清空
          var oAddressLis = oAddressUl.querySelectorAll('li');
          for (var i = 0; i < oAddressLis.length; i++) {
            oAddressLis[i].classList.remove('selected');
          }

          if (target.nodeName === 'LI') {
            //点击LI元素选择一个收货地址
            selected_address_id = parseInt(target.dataset.id);
            target.classList.add('selected');
          } else if (target.nodeName === 'SPAN'){
            selected_address_id = parseInt(target.parentNode.dataset.id);
            target.parentNode.classList.add('selected');
          }

        }
      }
    </script>

    <div id="order">下订单/结算</div>
    <script>
      var oOrder = document.querySelector('#order');
      oOrder.onclick = function() {
        var address_id = selected_address_id;
        if (address_id === 0) {
          alert('请选择一个收货地址');
          return;
        }
        var total_prices = localStorage.sum;
        myajax.post('http://h6.duchengjiu.top/shop/api_order.php?token='+localStorage.token+'&status=add', {address_id, total_prices}, function(err, responseText){
            var json = JSON.parse(responseText);
            console.log(json);
            if (json.code === 0) {
              alert('下订单成功');
              location.href = 'order.html';
            }
        });

      }
    </script>
  </main>
  <div class="modal register">
    <div class="container">
      <div class="hd">添加收货地址<span class="close">关闭</span></div>
      <div class="bd">
        <form>
          <label>
            地址名称: <input type="text" name="address_name" value="家">
          </label>
          <label>
            收货人: <input type="text" name="consignee" value="maxwelldu">
          </label>
          <label>
            国家: <input type="text" name="country" value="中国">
          </label>
          <label>
            省: <input type="text" name="province" value="北京">
          </label>
          <label>
            市: <input type="text" name="city" value="北京">
          </label>
          <label>
            区: <input type="text" name="district" value="石景山">
          </label>
          <label>
            地址: <input type="text" name="address" value="实兴东街11号朗诚大厦南楼二层">
          </label>
          <label>
            邮编: <input type="text" name="zip_code" value="100000">
          </label>
          <label>
            手机号: <input type="text" name="mobile" value="18518368050">
          </label>
          <label>
            邮箱: <input type="text" name="email" value="dcj3sjt@126.com">
          </label>
          <label>
            电话: <input type="text" name="tel" value="010-91519281">
          </label>
          <label>
            最佳送货时间: <input type="text" name="besttime" value="周一到周五">
          </label>
          <label>
            标志物: <input type="text" name="sign_building" value="">
          </label>
          <label>
            <input type="button" value="添加" class="add">
          </label>
        </form>
      </div>
    </div>
  </div>
  <script>
    var modal = new Modal('#add-address');

    //给添加按钮添加事件
    var oAdd = document.querySelector('.add');
    oAdd.onclick = function() {
      var postobj = serializeForm(document.querySelector('form'));
      myajax.post('http://h6.duchengjiu.top/shop/api_useraddress.php?status=add&token='+localStorage.token, postobj, function(err, responseText){
        var json = JSON.parse(responseText);
        console.log(json);
        if (json.code === 0) {
          modal.hide();
          showAddress();
        }
      });
    }
  </script>
		<div class="footer">
			<div class="icon">
				<a href="#">
					<span class="hand"></span>
					<span class="shop-icon"></span>
				</a>				
			</div>
			<div class="slogen">
				<dl>
					<dt class="dt1"></dt>
					<dd>
						<p class="chinese">全球精品</p>
						<p class="english">Global Selection</p>
					</dd>
				</dl>
				<dl>
					<dt class="dt2"></dt>
					<dd>
						<p class="chinese">正品保证</p>
						<p class="english">Autherticity Guaranteed</p>
					</dd>
				</dl>
				<dl>
					<dt class="dt3"></dt>
					<dd>
						<p class="chinese">全场包邮</p>
						<p class="english">Free Delivery</p>
					</dd>
				</dl>
				<dl>
					<dt class="dt4"></dt>
					<dd>
						<p class="chinese">400-897-6336</p>
						<p class="english">工作日 09:00-18:00</p>
					</dd>
				</dl>
			</div>	
		</div>
		<div class="copy">
			<div class="copy-top">
				<a class="phone" href="#">
					<i></i>
					<div class="text">
						<p>iPone Android</p>
						<p>客户端下载</p>
					</div>
					<div class="code">
						<dl class="dl1">
							<dt></dt>
							<dd>下载iPone版</dd>
						</dl>
						<dl class="dl2">
							<dt></dt>
							<dd>下载Android版</dd>
						</dl>
					</div>
				</a>
				<ul>
					<li class="wx">
						<i></i>
						<a href="#"></a>
					</li>
					<li class="wb"><a href="#"></a></li>
					<li class="db"><a href="#"></a></li>
				</ul>
			</div>
			<div class="copy-down">
				<ul>
					<li class="first"><a href="#">关于良仓</a></li>
					<li><a href="#">服务协议</a></li>
					<li><a href="#">隐私保护政策</a></li>
					<li><a href="#">使用指南</a></li>
					<li><a href="#">联系我们</a></li>
					<li><a href="#">加入我们</a></li>
					<li><a href="#">友情链接</a></li>
					<li><a href="#">私信良仓</a></li>
				</ul>
				<p class="copy-code">
					<span>&copy;</span>
					<span>2013-2015 北京良仓文化传播有限公司版权所有 京</span>
					<span>京ICP备13010677号-1</span>
					<span>京公网安备11010502025627</span>
				</p>
				<p class="company">公司名称：北京良仓文化传播有限公司  电话：010-58263516</p>
				<p class="address">公司地址：北京朝阳区百子湾路32号6号楼1层60号.</p>
				<p class="licence">社会信用统一代码：91110105059231575L  食品许可证：JY11105160159557  </p>
				<p class="library-card"> 图书证名称：中华人民共和国出版物经营许可证  图书证编号：新出发京零 字第 朝 150051 号 </p>
			</div>
		</div>
	</body>
</html>
